#! /bin/sh
# File          :  copsor
# Created       :  Wed 07 Oct 2015 23:05:52
# Last Modified :  Sat 24 Oct 2015 13:45:19
# Maintainer    :  sharlatan, <sharlatanus@gmail.com>
# License       :  Same as Bash (GPL)
# Credits:
#
#..:: Description ::..
# Copy and sort imgs from plugged camera.
# Using udev rules to determine weather device is added.
# Requred   :
#           : exiftool (http://www.sno.phy.queensu.ca/~phil/exiftool/)
# 

# This rule has to be added to /etc/udev/rules.d/<your_file_name>
# ACTION=="add", ATTRS{idVendor}="NIKON", RUN+="/home/<user_name>/.bin/copsor

# Load lib/tiny-tools-vars.sh
ABS_PATH=$(realpath $0 |  grep -Po "(?:(\S)*)(tiny-toolbox)")
source ${ABS_PATH}/lib/vars-lib

echo Making: ${DST_DIR}
# make DST_DIR if not exists
if [[ ! -d ${DST_DIR} ]]; then
    mkdir ${DST_DIR}
fi

echo Moving from: ${SRC_DIR}
# moving, sorting and cleaning empty dirs
if [[ -d ${SRC_DIR} ]]; then
    find ${SRC_DIR} -type f -exec mv {} ${DST_DIR} \;
    find ${SRC_DIR} -type d -empty -delete 2>/dev/null
    # sorting files in DST_DIR
    exiftool -r '-Directory<DateTimeOriginal' \
        -d ${DST_DIR}/%d_%B_%Y  -r ${DST_DIR}
fi

exit 0
