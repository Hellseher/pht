#! /bin/sh
# File          :  copsor
# Created       :  Wed 07 Oct 2015 23:05:52
# Last Modified :  Wed 14 Oct 2015 19:34:58
# Maintainer    :  sharlatan, <sharlatanus@gmail.com>
# License       :  Same as Bash (GPL)
# Credits:
#
#..:: Description ::..
# Copy and sort imgs from plugged camera.
# Using udev rules to determine weather device is added.
# Requred   :
#           : exiftool (http://www.sno.phy.queensu.ca/~phil/exiftool/)
# 

# This rule has to be added to /etc/udev/rules.d/<your_file_name>
#
# ACTION=="add", ATTRS{idVendor}="NIKON", RUN+="/home/<user_name>/.bin/copsor


# --[ BEGIN of constants ]---
IMG_PWD="/Data/picvid/phts/tmp/"

UDIR=$(cat /etc/passwd | grep $USER | cut -d: -f6)
DIST_DIR=${UDIR}${IMG_PWD}$(date +"%a_%B_%d_%Y")
SOURCE_DIR="/run/user/$UID/gvfs/"
# --[ END of constants ]---

# make DIST_DIR if not exists
if [[ ! -d ${DIST_DIR} ]]; then
    mkdir ${DIST_DIR}
fi

# moving, sorting and cleaning empty dirs
if [[ -d ${SOURCE_DIR} ]]; then
    find ${SOURCE_DIR} -type f -exec mv {} ${DIST_DIR} \;
    find ${SOURCE_DIR} -type d -empty -exec rmdir {} \;
    # sorting files in DIST_DIR
    exiftool -r '-Directory<DateTimeOriginal' \
        -d ${DIST_DIR}/%d_%B_%Y  -r ${DIST_DIR}
fi
