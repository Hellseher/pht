#! /bin/sh
# File          :  iptack
# Created       :  Sat 22 Aug 2015 22:51:54
# Last Modified :  Fri 30 Oct 2015 01:21:55
# Maintainer    :  sharlatan, <sharlatanus@gmail.com>
# License       :  Same as Bash (GPL)
# Credits:
#
#..:: Description ::..
# Shows ip of ssh attackers, country and how many attempts were made
#
# 
if [[ -e  ~/.local/bin/var-lib && -e ~/.local/bin/fun-lib ]]; then
    . ~/.local/bin/var-lib
    . ~/.local/bin/fun-lib
else
    . ./var-lib
    . ./fun-lib
fi

if_sudo

# list of attackers IPs
IP_SORTED=$(awk -F" " '/sshd.*Invalid/ {print $10}' /var/log/secure | sort -u)
IP_UNSORTED=$(awk -F" " '/sshd.*Invalid/ {print $10}' /var/log/secure)

if [[ $EUID -ne 0 ]]; then
    echo "This script must be run as root" 
    exit 1
fi

for ip in $IP_SORTED; do
    ip_country=$(geoiplookup $ip | grep -Po '(?<=:\s)\w+')
    printf "$ip $ip_country"
done
